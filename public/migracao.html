<!DOCTYPE html>
<!-- saved from url=(0117)https://tess-workflows-files.storage.googleapis.com/68560e5243f8de9b99b9623351260b8b11c2bf0a/migracao-cloudinary.html -->
<html lang="pt-BR"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Migração para Cloudinary</title>
  <link rel="stylesheet" href="./migracao_files/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    h1 {
      color: #1e3a5f;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    h1 i { color: #3b82f6; }

    .subtitle {
      color: #64748b;
      margin-bottom: 30px;
    }

    .info-box {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .info-box h3 {
      color: #0369a1;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .info-box ul {
      color: #0c4a6e;
      font-size: 14px;
      margin-left: 20px;
    }

    .info-box li { margin-bottom: 4px; }

    .warning-box {
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .warning-box h3 {
      color: #92400e;
      font-size: 14px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .warning-box p {
      color: #78350f;
      font-size: 14px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
      justify-content: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #e2e8f0;
      color: #475569;
      margin-top: 12px;
    }

    .btn-secondary:hover {
      background: #cbd5e1;
    }

    #status {
      margin-top: 24px;
      padding: 16px;
      border-radius: 8px;
      display: none;
    }

    #status.success {
      display: block;
      background: #dcfce7;
      border: 1px solid #86efac;
      color: #166534;
    }

    #status.error {
      display: block;
      background: #fee2e2;
      border: 1px solid #fca5a5;
      color: #991b1b;
    }

    #status.running {
      display: block;
      background: #dbeafe;
      border: 1px solid #93c5fd;
      color: #1e40af;
    }

    .progress-bar {
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      margin-top: 12px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      border-radius: 4px;
      transition: width 0.3s;
      width: 0%;
    }

    #resultados {
      margin-top: 20px;
      font-size: 14px;
    }

    #resultados ul {
      margin-top: 8px;
      margin-left: 20px;
    }

    .spinner {
      animation: spin 1s linear infinite;
      display: inline-block;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
<style>undefined</style></head>
<body>
  <div class="container">
    <h1><i class="fas fa-cloud-upload-alt"></i> Migração Cloudinary</h1>
    <p class="subtitle">Migrar imagens base64 para armazenamento em nuvem</p>

    <div class="info-box">
      <h3><i class="fas fa-info-circle"></i> O que esta migração faz:</h3>
      <ul>
        <li>Busca todas as fichas com imagens em base64</li>
        <li>Faz upload de cada imagem para o Cloudinary</li>
        <li>Atualiza o banco com as URLs do Cloudinary</li>
        <li>Remove os dados base64 do banco (libera espaço)</li>
      </ul>
    </div>

    <div class="warning-box">
      <h3><i class="fas fa-exclamation-triangle"></i> Atenção</h3>
      <p>Certifique-se de que as credenciais do Cloudinary estão configuradas no servidor antes de executar.</p>
    </div>

    <button id="btnMigrar" class="btn btn-primary">
      <i class="fas fa-rocket"></i>
      Iniciar Migração
    </button>

    <a href="https://tess-workflows-files.storage.googleapis.com/68560e5243f8de9b99b9623351260b8b11c2bf0a/dashboard.html" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i>
      Voltar ao Dashboard
    </a>

    <div id="status">
      <div id="statusMessage"></div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div id="resultados"></div>
    </div>
  </div>

  <script src="./migracao_files/api-client.js.baixados"></script>
  <script>
    const btnMigrar = document.getElementById('btnMigrar');
    const statusDiv = document.getElementById('status');
    const statusMessage = document.getElementById('statusMessage');
    const progressFill = document.getElementById('progressFill');
    const resultadosDiv = document.getElementById('resultados');

    btnMigrar.addEventListener('click', async () => {
      if (!confirm('Deseja iniciar a migração? Este processo pode demorar dependendo da quantidade de imagens.')) {
        return;
      }

      btnMigrar.disabled = true;
      btnMigrar.innerHTML = '<i class="fas fa-spinner spinner"></i> Migrando...';

      statusDiv.className = 'running';
      statusMessage.innerHTML = '<i class="fas fa-spinner spinner"></i> Migrando imagens para o Cloudinary...';
      progressFill.style.width = '10%';
      resultadosDiv.innerHTML = '';

      try {
        const response = await fetch('/api/cloudinary/migrar', {
          method: 'POST'
        });

        progressFill.style.width = '90%';

        if (!response.ok) {
          throw new Error('Erro na resposta do servidor');
        }

        const resultado = await response.json();

        progressFill.style.width = '100%';

        statusDiv.className = 'success';
        statusMessage.innerHTML = `<i class="fas fa-check-circle"></i> Migração concluída!`;

        resultadosDiv.innerHTML = `
          <strong>Resultados:</strong>
          <ul>
            <li>Fichas analisadas: ${resultado.total}</li>
            <li>Fichas migradas: ${resultado.migradas}</li>
            <li>Erros: ${resultado.erros?.length || 0}</li>
          </ul>
          ${resultado.erros?.length > 0 ? `
            <br><strong>Erros:</strong>
            <ul>
              ${resultado.erros.slice(0, 5).map(e => `<li>${e}</li>`).join('')}
              ${resultado.erros.length > 5 ? `<li>... e mais ${resultado.erros.length - 5} erros</li>` : ''}
            </ul>
          ` : ''}
        `;

      } catch (error) {
        statusDiv.className = 'error';
        statusMessage.innerHTML = `<i class="fas fa-times-circle"></i> Erro na migração`;
        resultadosDiv.innerHTML = `<p>${error.message}</p>`;
      }

      btnMigrar.disabled = false;
      btnMigrar.innerHTML = '<i class="fas fa-rocket"></i> Iniciar Migração';
    });
  </script>


</body></html>